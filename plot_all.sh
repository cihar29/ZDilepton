#!/bin/bash

# execute as ./plot_all.sh channel cut# DRcut

args=("$@")

if [ $# -ne 3 ] ; then
  echo "Please provide a channel (mm, ee, em), cut# (0, 1, ...), and a DR cut (OFF, ON, ONbt, ONnb, REVERSE)."
  exit
fi

chan=${args[0]}
cut=${args[1]}
region=${args[2]}

if [[ $region = "OFF" ]] ; then
  dir="/uscms_data/d3/cihar29/Analysis/CMSSW_8_0_30/src/analysis/ZDilepton/off/"
  reg="false"
elif [[ $region = "ON" ]] ; then
  dir="/uscms_data/d3/cihar29/Analysis/CMSSW_8_0_30/src/analysis/ZDilepton/on/"
  reg="false"
elif [[ $region = "ONbt" ]] ; then
  dir="/uscms_data/d3/broozbah/pre_aproval/CMSSW_8_0_26_patch2/src/analysis/ZDilepton/ONbt_mmem/"
  reg="bt"
elif [[ $region = "ONnb" ]] ; then
  dir="/uscms_data/d3/broozbah/pre_aproval/CMSSW_8_0_26_patch2/src/analysis/ZDilepton/ONnb_mmem/"
  reg="nb"
elif [[ $region = "REVERSE" ]] ; then
  dir="/uscms_data/d3/cihar29/Analysis/CMSSW_8_0_30/src/analysis/ZDilepton/rev/"
  reg="rev"
else
  echo "DRcut not found."
  exit
fi

if [[ $chan = "mm" ]] ; then
  dir="${dir}mm/"
  dataset="Muon"
elif [[ $chan = "ee" ]] ; then
  dir="${dir}ee/"
  dataset="Ele"
else
  dir="${dir}em/"
  dataset="Muon"
fi

subplot="ratio"
if [[ "${subplot}" == "ratio" ]] ; then
  subymin="0"
else
  subymin="-2"
fi

hists=( "dilepmass" "jet0btag" "jet0eta" "jet0pt" "jet1btag" "jet1eta" "jet1pt" "jethT" "lep0eta" "lep0pt" "lep1eta" "lep1pt" "metcorrpt" "sT" "masslljjm"
        "lep0perp" "lep1perp" "lepept" "lepmpt" "metpt" "nGoodEle" "nGoodMuon" "nGoodJet" "minjet0pt" "minjet1pt" "cleanjet0pt" "cleanjet1pt" "nbtag"
        "rl0cleanj" "rl1cleanj" "rl0l1" "rmin0" "rmin1" "sumrmin" "rbl" "masslmin0" "masslmin1" "sT_met" "dphi_jet0met" "dphi_jet1met" "nPV" "lep0perp_in" "lep1perp_in"
      )

xmins=( 0 0 -5 0 0 -5 0 0 -5 0 -5 0 0 0 0
        0 0 0 0 0 0 0 0 0 0 0 0 0
        0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
      )

xmaxs=( 1000 1 5 2000 1 5 2000 3000 5 1000 5 600 1000 5000 5000
        200 200 1000 1000 1000 5 5 25 1000 1000 1000 1000 5
        5 5 5 5 5 10 5 2000 2000 5000 3 3 80 200 200
      )

for ((i=0;i<${#hists[@]};++i)) ; do

  #if [[ "${hists[i]}" != "sT_met" ]] ; then
  #if [[ "${hists[i]}" != "masslljjm" ]] ; then
  #if [[ "${hists[i]}" != "masslljjm" && "${hists[i]}" != "sT_met" ]] ; then
  #  continue
  #fi

  logy="false"
  if [[ "${hists[i]}" == *"pt"* || "${hists[i]}" == "sT"* || "${hists[i]}" == "jethT" || "${hists[i]}" == "masslljjm" ]] ; then
    logy="true"
  fi

  rebin="2"
  if [[ "${hists[i]}" == "metcorrpt" || "${hists[i]}" == "metpt" ]] ; then
    rebin="0 50 100 150 200 250 300 350 400 450 500 550 600 650 700 750 800 850 900 950 1000 1100 1200 1300 1400 1500 1600 1700 1800 1900 2000 2500 5000"
  elif [[ "${hists[i]}" == "sT" || "${hists[i]}" == "jethT" ]] ; then
    rebin="0 50 100 150 200 250 300 350 400 450 500 550 600 650 700 750 800 850 900 950 1000 1050 1100 1150 1200 1250 1300 1350 1400 1450 1500 1600 1800 2000 2500 3000 5000"
  elif [[ "${hists[i]}" == *"Good"* || "${hists[i]}" == "nbtag" || ("${hists[i]}" == *"perp"* && "${hists[i]}" != *"probe"*) ]] ; then
    rebin="1"
  elif [[ "${hists[i]}" == "sT_met" ]] ; then
    if [[ $chan = "mm" ]] ; then
      if [[ $region = "OFF" ]] ; then
        rebin="0 290 330 370 410 450 490 530 570 610 650 690 730 770 810 850 890 930 970 1010 1050 1090 1130 1170 1210 1250 1290 1330 1370 1410 1450 1490 1530 1570 1610 1650 1690 1730 1770 1810 1850 1890 1930 1970 2010 2050 2090 2130 2170 2210 2250 2300 2350 2430 2540 2670 2830 3120 5000"
      elif [[ $region = "ON" ]] ; then
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2130 2170 2210 2250 2300 2360 2450 2560 2710 2850 3180 5000"
      elif [[ $region = "ONbt" ]] ; then
        rebin="0 390 430 470 510 550 590 630 670 710 750 790 830 870 910 950 990 1030 1070 1110 1150 1190 1230 1270 1310 1350 1390 1430 1470 1510 1550 1590 1630 1670 1710 1750 1790 1830 1870 1910 1950 1990 2040 2080 2150 2210 2290 2390 2580 2820 5000"
      elif [[ $region = "ONnb" ]] ; then
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1930 1970 2030 2100 2190 2270 2420 2660 5000"
      elif [[ $region = "REVERSE" ]] ; then
        rebin="0 300 340 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1420 1460 1500 1550 1620 1720 1920 5000"
        #rebin="0 300 340 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1420 1500 1580 1660 1770 2010 5000"
      fi
    elif [[ $chan = "ee" ]] ; then
      if [[ $region = "OFF" ]] ; then
        rebin="0 300 340 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1420 1460 1500 1540 1580 1620 1660 1700 1740 1780 1820 1860 1900 1940 1990 2040 2110 2200 2340 2520 5000"
      elif [[ $region = "ON" ]] ; then
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1980 2030 2090 2190 2330 2510 5000"
      elif [[ $region = "ONbt" ]] ; then
        rebin="0 410 450 490 530 570 610 650 690 730 770 810 850 890 930 970 1010 1050 1090 1130 1170 1210 1250 1290 1330 1370 1410 1450 1490 1530 1570 1610 1650 1690 1730 1790 1870 1970 2120 2400 5000"
      elif [[ $region = "ONnb" ]] ; then
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1810 1860 1910 1990 2090 2310 5000"
      elif [[ $region = "REVERSE" ]] ; then
        rebin="0 300 340 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1440 1510 1630 5000"
        #rebin="0 300 340 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1240 1440 1550 1750 5000"
      fi
    else
      if [[ $region = "OFF" ]] ; then
        rebin="0 300 340 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1420 1460 1500 1540 1580 1620 1660 1700 1740 1780 1820 1860 1900 1940 1980 2020 2060 2100 2140 2180 2220 2260 2320 2360 2430 2500 2580 2700 2880 5000"
      elif [[ $region = "ON" ]] ; then
        rebin="0 310 350 390 430 470 510 550 590 630 670 710 750 790 830 870 910 950 990 1030 1070 1110 1150 1190 1230 1270 1310 1350 1390 1430 1470 1510 1550 1590 1630 1670 1710 1750 1790 1830 1870 1910 1950 1990 2030 2070 2110 2150 2190 2230 2270 2330 2370 2450 2520 2620 2760 2960 5000"
      elif [[ $region = "ONbt" ]] ; then
        rebin="0 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1420 1460 1500 1540 1580 1620 1660 1700 1740 1780 1820 1860 1900 1940 1990 2040 2090 2140 2210 2290 2390 2540 2760 5000"
      elif [[ $region = "ONnb" ]] ; then
        rebin="0 310 350 390 430 470 510 550 590 630 670 710 750 790 830 870 910 950 990 1030 1070 1110 1150 1190 1230 1270 1310 1350 1390 1430 1470 1510 1550 1590 1630 1670 1710 1750 1790 1830 1870 1910 1950 1990 2030 2070 2120 2180 2240 2340 2460 2590 5000"
      elif [[ $region = "REVERSE" ]] ; then
        rebin="0 300 340 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1420 1460 1500 1540 1590 1660 1740 1900 5000"
        #rebin="0 300 340 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1310 1370 1430 1470 1550 5000"
      fi
    fi
  elif [[ "${hists[i]}" == "masslljjm" ]] ; then
    if [[ $chan = "mm" ]] ; then
      if [[ $region = "OFF" ]] ; then
        rebin="0 310 350 390 430 470 510 550 590 630 670 710 750 790 830 870 910 950 990 1030 1070 1110 1150 1190 1230 1270 1310 1350 1390 1430 1470 1510 1550 1590 1630 1670 1710 1750 1790 1830 1870 1910 1950 1990 2030 2070 2110 2150 2190 2230 2270 2310 2350 2390 2430 2470 2510 2550 2610 2660 2720 2790 2890 3020 3170 3330 5000"
      elif [[ $region = "ON" ]] ; then
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2120 2160 2200 2240 2280 2320 2360 2400 2440 2480 2530 2600 2660 2730 2830 2890 3040 3220 3460 5000"
      elif [[ $region = "ONbt" ]] ; then
        rebin="0 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2130 2170 2230 2290 2350 2420 2520 2680 2850 3060 5000"
      elif [[ $region = "ONnb" ]] ; then
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2120 2160 2200 2240 2280 2320 2360 2420 2510 2590 2690 2880 3100 5000"
      elif [[ $region = "REVERSE" ]] ; then
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2010 2060 2140 2230 2360 2550 5000"
      fi
    elif [[ $chan = "ee" ]] ; then
      if [[ $region = "OFF" ]] ; then
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2120 2160 2200 2240 2280 2330 2380 2430 2500 2580 2680 2840 3130 5000"
      elif [[ $region = "ON" ]] ; then
        rebin="0 330 370 410 450 490 530 570 610 650 690 730 770 810 850 890 930 970 1010 1050 1090 1130 1170 1210 1250 1290 1330 1370 1410 1450 1490 1530 1570 1610 1650 1690 1730 1770 1810 1850 1890 1930 1970 2010 2050 2090 2130 2170 2210 2260 2310 2370 2450 2530 2640 2840 5000"
      elif [[ $region = "ONbt" ]] ; then
        rebin="0 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1930 1980 2060 2160 2300 2510 5000"
      elif [[ $region = "ONnb" ]] ; then
        rebin="0 330 370 410 450 490 530 570 610 650 690 730 770 810 850 890 930 970 1010 1050 1090 1130 1170 1210 1250 1290 1330 1370 1410 1450 1490 1530 1570 1610 1650 1690 1730 1770 1810 1850 1890 1930 1970 2010 2050 2090 2140 2190 2250 2310 2390 2530 2690 5000"
      elif [[ $region = "REVERSE" ]] ; then
        rebin="0 330 370 410 450 490 530 570 610 650 690 730 770 810 850 890 930 970 1010 1050 1090 1130 1170 1210 1250 1290 1330 1370 1410 1450 1490 1530 1570 1610 1650 1690 1730 1770 1810 1850 1900 1970 2060 2170 2350 5000"
      fi
    else
      if [[ $region = "OFF" ]] ; then
        rebin="0 310 350 390 430 470 510 550 590 630 670 710 750 790 830 870 910 950 990 1030 1070 1110 1150 1190 1230 1270 1310 1350 1390 1430 1470 1510 1550 1590 1630 1670 1710 1750 1790 1830 1870 1910 1950 1990 2030 2070 2110 2150 2190 2230 2270 2310 2350 2390 2430 2470 2510 2550 2590 2640 2680 2720 2770 2840 2930 3020 3150 3330 5000"
      elif [[ $region = "ON" ]] ; then
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2120 2160 2200 2240 2280 2320 2360 2400 2440 2480 2520 2560 2610 2660 2710 2760 2840 2940 3050 3210 3410 5000"
      elif [[ $region = "ONbt" ]] ; then
        rebin="0 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1420 1460 1500 1540 1580 1620 1660 1700 1740 1780 1820 1860 1900 1940 1980 2020 2060 2100 2140 2180 2220 2270 2330 2380 2450 2560 2670 2830 3050 5000"
      elif [[ $region = "ONnb" ]] ; then
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2120 2160 2200 2240 2280 2320 2360 2400 2440 2480 2540 2600 2690 2780 2950 3170 5000"
      elif [[ $region = "REVERSE" ]] ; then
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2130 2190 2270 2360 2510 2740 5000"
      fi
    fi
  fi

  lines=( "dataFileName   ${dataset}"
          "plotData       true"
          "dir            ${dir}"
          "channel        ${chan}"
          "fileNames      TTbar0-700 TTbar700-1000 TTbar1000-inf DYhigh DYlow STschannel STtWchannel STtchannel SaTtWchannel SaTtchannel WJets WW WZ ZZ gluon_M-4500 gluon_M-5000 gluon_M-1000 gluon_M-1250 gluon_M-1500 gluon_M-2000 gluon_M-2500 gluon_M-3000 gluon_M-3500 gluon_M-4000 gluon_M-500 gluon_M-750 zprime_M-1000_W-10 zprime_M-1000_W-100 zprime_M-1000_W-300 zprime_M-1250_W-125 zprime_M-1250_W-12p5 zprime_M-1500_W-15 zprime_M-1500_W-150 zprime_M-3000_W-300 zprime_M-500_W-5 zprime_M-500_W-50 zprime_M-750_W-7p5 zprime_M-750_W-75 zprime_M-2000_W-20 zprime_M-2000_W-200 zprime_M-2000_W-600 zprime_M-2500_W-25 zprime_M-2500_W-250 zprime_M-3000_W-30 zprime_M-3000_W-900 zprime_M-3500_W-35 zprime_M-3500_W-350 zprime_M-4000_W-40 zprime_M-4000_W-400 zprime_M-4000_W-1200 zprime_M-4500_W-45 zprime_M-4500_W-450 zprime_M-5000_W-50 zprime_M-5000_W-500 zprime_M-5000_W-1500"
                          #qcd30-50_Mu qcd50-80_Mu qcd80-120_Mu qcd120-170_Mu qcd170-300_Mu qcd300-470_Mu qcd470-600_Mu qcd600-800_Mu qcd800-1000_Mu qcd1000-inf_Mu qcd30-50_EM qcd50-80_EM qcd80-120_EM qcd120-170_EM qcd170-300_EM qcd300-inf_EM qcd30-80_bcToE qcd80-170_bcToE qcd170-250_bcToE qcd250-inf_bcToE"
          "sigScale       10"
          "leftText       CMS"
          "rightText      Run 2016 - 35.9 fb^{-1} (13 TeV)"
          "logx           false"
          "logy           ${logy}"
          "subplot        ${subplot}"
          "outName        ${chan}/${cut}/${hists[i]}"
          "hname          ${cut}_${hists[i]}"
          "xmin           ${xmins[i]}"
          "xmax           ${xmaxs[i]}"
          "ymin           0"
          "subymin        ${subymin}"
          "subymax        2"
          "systematics    jec jer btagSF mistagSF pileup topPtWeight pdf q2ttbar muTrigSys muIdSys eleTrigSys eleIdSys"
          "sys_norm       lumi:0.025 sig_dy:0.2 sig_st:0.16 sig_db:0.15"
          "rebin          ${rebin}"
          "plotImpact     false"
          "theta          false"  # zp1, zp10, zp30, or gkk
          "region         ${reg}" # rev, bt, nb
          "fit            false"
          #"postfilename   /uscms_data/d3/cihar29/Analysis/CMSSW_8_1_0/src/theta/utils2/2017/all_st/gkk/histo_fits"
        )
  out=""

  for line in "${lines[@]}" ; do
    out="$out$line\n"
  done

  echo -e "$out" > plot_pars.txt
  plot plot_pars.txt

done
