#!/bin/bash

# execute as ./plot_all.sh channel cut#

args=("$@")

if [ $# -ne 2 ] ; then
  echo "Please provide a channel (mm, ee, em) and cut# (0, 1, ...)"
fi

if [ $# -eq 2 ] ; then

  channel=${args[0]}
  cut=${args[1]}
  dir="~broozbah/nobackup/ANA_2017/CMSSW_8_0_26/src/analyze/ZDilepton/ONnb/"
  #off/
  #on/
  #~broozbah/nobackup/ANA_2017/CMSSW_8_0_26/src/analyze/ZDilepton/ONbt/
  #~broozbah/nobackup/ANA_2017/CMSSW_8_0_26/src/analyze/ZDilepton/ONnb/
  #reverse/

  if [[ $channel = "mm" ]] ; then
    dir="${dir}mm/"
    dataset="Muon"
  elif [[ $channel = "ee" ]] ; then
    dir="${dir}ee/"
    dataset="Ele"
  else
    dir="${dir}em/"
    dataset="Muon"
  fi

  subplot="ratio"
  if [[ "${subplot}" == "ratio" ]] ; then
    subymin="0"
  else
    subymin="-2"
  fi

  hists=( "dilepmass" "jet0btag" "jet0eta" "jet0pt" "jet1btag" "jet1eta" "jet1pt" "jethT" "lep0eta" "lep0pt" "lep1eta" "lep1pt" "metcorrpt" "sT" "masslljjm"
          "lep0perp" "lep1perp" "lepept" "lepmpt" "metpt" "nGoodEle" "nGoodMuon" "nGoodJet" "minjet0pt" "minjet1pt" "cleanjet0pt" "cleanjet1pt" "nbtag"
          "rl0cleanj" "rl1cleanj" "rl0l1" "rmin0" "rmin1" "sumrmin" "rbl" "masslmin0" "masslmin1" "sT_met" "dphi_jet0met" "dphi_jet1met" "nPV" "lep0perp_in" "lep1perp_in" )

  xmins=( 0 0 -5 0 0 -5 0 0 -5 0 -5 0 0 0 0
          0 0 0 0 0 0 0 0 0 0 0 0 0
          0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)

  xmaxs=( 1000 1 5 2000 1 5 2000 3000 5 1000 5 600 1000 5000 5000
          200 200 1000 1000 1000 5 5 25 1000 1000 1000 1000 5
          5 5 5 5 5 10 5 2000 2000 5000 3 3 80 200 200)

  for ((i=0;i<${#hists[@]};++i)); do

    #if [[ "${hists[i]}" != "sT_met" ]] ; then
    #if [[ "${hists[i]}" != "masslljjm" ]] ; then
    #  continue
    #fi

    logy="false"
    if [[ "${hists[i]}" == *"pt"* || "${hists[i]}" == "sT"* || "${hists[i]}" == "jethT" || "${hists[i]}" == "masslljjm" ]] ; then
      logy="true"
    fi

    rebin="2"
    if [[ "${hists[i]}" == "metcorrpt" || "${hists[i]}" == "metpt" ]] ; then
      rebin="0 50 100 150 200 250 300 350 400 450 500 550 600 650 700 750 800 850 900 950 1000 1100 1200 1300 1400 1500 1600 1700 1800 1900 2000 2500 5000"
    elif [[ "${hists[i]}" == "sT" || "${hists[i]}" == "jethT" ]] ; then
      rebin="0 50 100 150 200 250 300 350 400 450 500 550 600 650 700 750 800 850 900 950 1000 1050 1100 1150 1200 1250 1300 1350 1400 1450 1500 1600 1800 2000 2500 3000 5000"
    elif [[ "${hists[i]}" == *"Good"* || "${hists[i]}" == "nbtag" || "${hists[i]}" == *"perp"* ]] ; then
      rebin="1"
    elif [[ "${hists[i]}" == "sT_met" ]] ; then
      if [[ $channel = "mm" ]] ; then
        #rebin="0 290 330 370 410 450 490 530 570 610 650 690 730 770 810 850 890 930 970 1010 1050 1090 1130 1170 1210 1250 1290 1330 1370 1410 1450 1490 1530 1570 1610 1650 1690 1730 1770 1810 1850 1890 1930 1970 2010 2050 2090 2130 2170 2210 2250 2300 2350 2430 2540 2670 2830 3120 5000"
        #rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2130 2170 2210 2250 2300 2360 2440 2550 2690 2850 3180 5000"
        #rebin="0 390 430 470 510 550 590 630 670 710 750 790 830 870 910 950 990 1030 1070 1110 1150 1190 1230 1270 1310 1350 1390 1430 1470 1510 1550 1590 1630 1670 1710 1750 1790 1830 1870 1910 1950 1990 2040 2080 2150 2210 2290 2380 2570 2820 5000"
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1930 1970 2030 2100 2190 2270 2410 2640 5000"
        #rebin="0 300 340 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1420 1460 1500 1550 1620 1720 1920 5000"
      elif [[ $channel = "ee" ]] ; then
        #rebin="0 300 340 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1420 1460 1500 1540 1580 1620 1660 1700 1740 1780 1820 1860 1900 1940 1990 2040 2120 2220 2360 2590 5000"
        #rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1980 2030 2100 2200 2340 2530 5000"
        #rebin="0 410 450 490 530 570 610 650 690 730 770 810 850 890 930 970 1010 1050 1090 1130 1170 1210 1250 1290 1330 1370 1410 1450 1490 1530 1570 1610 1650 1690 1730 1790 1870 1970 2120 2390 5000"
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1810 1860 1910 1990 2090 2310 5000"
        #rebin="0 300 340 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1440 1510 1630 5000"
      else
        #rebin="0 300 340 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1420 1460 1500 1540 1580 1620 1660 1700 1740 1780 1820 1860 1900 1940 1980 2020 2060 2100 2140 2180 2220 2260 2320 2360 2430 2500 2580 2700 2880 5000"
        #rebin="0 310 350 390 430 470 510 550 590 630 670 710 750 790 830 870 910 950 990 1030 1070 1110 1150 1190 1230 1270 1310 1350 1390 1430 1470 1510 1550 1590 1630 1670 1710 1750 1790 1830 1870 1910 1950 1990 2030 2070 2110 2150 2190 2230 2270 2330 2370 2450 2520 2620 2760 2960 5000"
        #rebin="0 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1420 1460 1500 1540 1580 1620 1660 1700 1740 1780 1820 1860 1900 1940 1990 2040 2090 2140 2210 2290 2390 2540 2760 5000"
        rebin="0 310 350 390 430 470 510 550 590 630 670 710 750 790 830 870 910 950 990 1030 1070 1110 1150 1190 1230 1270 1310 1350 1390 1430 1470 1510 1550 1590 1630 1670 1710 1750 1790 1830 1870 1910 1950 1990 2030 2070 2120 2180 2240 2340 2460 2590 5000"
        #rebin="0 300 340 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1420 1460 1500 1540 1590 1650 1730 1850 5000"
      fi
    elif [[ "${hists[i]}" == "masslljjm" ]] ; then
      if [[ $channel = "mm" ]] ; then
        #rebin="0 310 350 390 430 470 510 550 590 630 670 710 750 790 830 870 910 950 990 1030 1070 1110 1150 1190 1230 1270 1310 1350 1390 1430 1470 1510 1550 1590 1630 1670 1710 1750 1790 1830 1870 1910 1950 1990 2030 2070 2110 2150 2190 2230 2270 2310 2350 2390 2430 2470 2510 2550 2610 2660 2720 2790 2890 3020 3170 3330 5000"
        #rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2120 2160 2200 2240 2280 2320 2360 2400 2440 2490 2540 2610 2660 2730 2830 2890 3040 3220 3460 5000"
        #rebin="0 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2130 2170 2230 2290 2350 2420 2520 2670 2850 3050 5000"
        #rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2120 2160 2200 2240 2280 2320 2360 2420 2510 2590 2690 2860 3090 5000"
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2010 2060 2140 2230 2360 2550 5000"
      elif [[ $channel = "ee" ]] ; then
        #rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2120 2160 2200 2240 2280 2330 2380 2430 2500 2580 2680 2840 3130 5000"
        #rebin="0 330 370 410 450 490 530 570 610 650 690 730 770 810 850 890 930 970 1010 1050 1090 1130 1170 1210 1250 1290 1330 1370 1410 1450 1490 1530 1570 1610 1650 1690 1730 1770 1810 1850 1890 1930 1970 2010 2050 2090 2130 2170 2210 2260 2310 2370 2450 2540 2650 2860 5000"
        #rebin="0 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1930 1980 2060 2160 2300 2510 5000"
        #rebin="0 330 370 410 450 490 530 570 610 650 690 730 770 810 850 890 930 970 1010 1050 1090 1130 1170 1210 1250 1290 1330 1370 1410 1450 1490 1530 1570 1610 1650 1690 1730 1770 1810 1850 1890 1930 1970 2010 2050 2090 2140 2190 2250 2310 2390 2530 2690 5000"
        rebin="0 330 370 410 450 490 530 570 610 650 690 730 770 810 850 890 930 970 1010 1050 1090 1130 1170 1210 1250 1290 1330 1370 1410 1450 1490 1530 1570 1610 1650 1690 1730 1770 1810 1850 1900 1970 2060 2170 2350 5000"
      else
        #rebin="0 310 350 390 430 470 510 550 590 630 670 710 750 790 830 870 910 950 990 1030 1070 1110 1150 1190 1230 1270 1310 1350 1390 1430 1470 1510 1550 1590 1630 1670 1710 1750 1790 1830 1870 1910 1950 1990 2030 2070 2110 2150 2190 2230 2270 2310 2350 2390 2430 2470 2510 2550 2590 2640 2680 2720 2770 2840 2930 3020 3150 3330 5000"
        #rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2120 2160 2200 2240 2280 2320 2360 2400 2440 2480 2520 2560 2610 2660 2710 2760 2850 2950 3070 3240 3450 5000"
        #rebin="0 380 420 460 500 540 580 620 660 700 740 780 820 860 900 940 980 1020 1060 1100 1140 1180 1220 1260 1300 1340 1380 1420 1460 1500 1540 1580 1620 1660 1700 1740 1780 1820 1860 1900 1940 1980 2020 2060 2100 2140 2180 2220 2270 2330 2380 2450 2550 2640 2770 2970 5000"
        #rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2120 2160 2200 2240 2280 2320 2360 2400 2440 2480 2540 2600 2690 2780 2950 3170 5000"
        rebin="0 320 360 400 440 480 520 560 600 640 680 720 760 800 840 880 920 960 1000 1040 1080 1120 1160 1200 1240 1280 1320 1360 1400 1440 1480 1520 1560 1600 1640 1680 1720 1760 1800 1840 1880 1920 1960 2000 2040 2080 2130 2190 2270 2360 2510 2740 5000"
      fi
    fi

    lines=( "dataFileName   ${dir}${dataset}_${channel}.root"
            "dataName       Data"
            "plotData       true"
            "mcFileNames    ${dir}TTbar0-700_${channel}.root ${dir}TTbar700-1000_${channel}.root ${dir}TTbar1000-inf_${channel}.root ${dir}DYhigh_${channel}.root ${dir}DYlow_${channel}.root ${dir}STschannel_${channel}.root ${dir}STtWchannel_${channel}.root ${dir}STtchannel_${channel}.root ${dir}SaTtWchannel_${channel}.root ${dir}SaTtchannel_${channel}.root ${dir}WJets_${channel}.root ${dir}WW_${channel}.root ${dir}WZ_${channel}.root ${dir}ZZ_${channel}.root"
            "sigFileNames   ${dir}gluon_M-4500_${channel}.root ${dir}gluon_M-5000_${channel}.root ${dir}gluon_M-1000_${channel}.root ${dir}gluon_M-1250_${channel}.root ${dir}gluon_M-1500_${channel}.root ${dir}gluon_M-2000_${channel}.root ${dir}gluon_M-2500_${channel}.root ${dir}gluon_M-3000_${channel}.root ${dir}gluon_M-3500_${channel}.root ${dir}gluon_M-4000_${channel}.root ${dir}gluon_M-500_${channel}.root ${dir}gluon_M-750_${channel}.root ${dir}zprime_M-1000_W-10_${channel}.root ${dir}zprime_M-1000_W-100_${channel}.root ${dir}zprime_M-1000_W-300_${channel}.root ${dir}zprime_M-1250_W-125_${channel}.root ${dir}zprime_M-1250_W-12p5_${channel}.root ${dir}zprime_M-1500_W-15_${channel}.root ${dir}zprime_M-1500_W-150_${channel}.root ${dir}zprime_M-3000_W-300_${channel}.root ${dir}zprime_M-500_W-5_${channel}.root ${dir}zprime_M-500_W-50_${channel}.root ${dir}zprime_M-750_W-7p5_${channel}.root ${dir}zprime_M-750_W-75_${channel}.root ${dir}zprime_M-2000_W-20_${channel}.root ${dir}zprime_M-2000_W-200_${channel}.root ${dir}zprime_M-2000_W-600_${channel}.root ${dir}zprime_M-2500_W-25_${channel}.root ${dir}zprime_M-2500_W-250_${channel}.root ${dir}zprime_M-3000_W-30_${channel}.root ${dir}zprime_M-3000_W-900_${channel}.root ${dir}zprime_M-3500_W-35_${channel}.root ${dir}zprime_M-3500_W-350_${channel}.root ${dir}zprime_M-4000_W-40_${channel}.root ${dir}zprime_M-4000_W-400_${channel}.root ${dir}zprime_M-4000_W-1200_${channel}.root ${dir}zprime_M-4500_W-45_${channel}.root ${dir}zprime_M-4500_W-450_${channel}.root ${dir}zprime_M-5000_W-50_${channel}.root ${dir}zprime_M-5000_W-500_${channel}.root ${dir}zprime_M-5000_W-1500_${channel}.root"
            "sigScales      10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10"
            "leftText       CMS"
            "rightText      Run 2016 - 35.9 fb^{-1} (13 TeV)"
            "logx           false"
            "logy           ${logy}"
            "subplot        ${subplot}"
            "outName        ${channel}/${cut}/${hists[i]}"
            "hname          ${cut}_${hists[i]}"
            "xmin           ${xmins[i]}"
            "xmax           ${xmaxs[i]}"
            "ymin           0"
            "subymin        ${subymin}"
            "subymax        2"
            "systematics    topPtWeight jec jer btagSF mistagSF pileup pdf q2ttbar q2dy q2st q2signal"
            "sys_norm       lumi:0.025 sig_st:0.16 sig_db:0.15 mutrig:0.005 muid:0.01 muiso:0.01 eltrig:0.01 elid:0.01 eliso:0.01"
            "rebin          ${rebin}"
            "plotImpact     false"
            "theta          false" # zp1, zp10, zp30, or gkk
            "region         false" # rev, bt, nb
            "fit            false"
            #"postfilename   /uscms_data/d3/cihar29/Analysis/CMSSW_8_1_0/src/theta/utils2/2017/all_st/gkk/histo_fits.root"
          )
    out=""

    for line in "${lines[@]}"
    do
      out="$out$line\n"
    done

    echo -e "$out" > plot_pars.txt

    plot plot_pars.txt

  done

fi
